<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Guitar Interval Trainer</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    .controls { margin-bottom: 1rem; }
    .fretboard-wrapper { display: inline-block; overflow-x: auto; }
    .fretboard { display: grid; grid-template-columns: 40px repeat(13, 60px); gap: 4px; }
    .fret-labels { display: contents; font-weight: bold; }
    .fret-label { padding: 4px; }
    .string-label { display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .note { padding: 8px; border: 1px solid #ccc; cursor: pointer; background: #f9f9f9; }
    .note.selected { background: #cce5ff; font-weight: bold; }
    .note.target { background: #d4edda; }
    #intervalDisplay { margin-top: 1rem; font-size: 1.2rem; }
    #abbrToggleLabel, #symbolToggleLabel { margin-right: 1rem; font-size: 0.95rem; }
    #displayModeLabel { margin-left: 1rem; font-size: 0.95rem; }
    button { margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem; }
    @media (max-width: 768px) {
      .note { padding: 6px; font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <h1>Guitar Fretboard Interval Trainer</h1>
  <p>Click a note to set the root, then another note to see the interval.</p>
  <div class="controls">
    <label id="abbrToggleLabel">
      <input type="checkbox" id="abbrToggle">
      Use interval abbreviations
    </label>
    <label id="symbolToggleLabel">
      <input type="checkbox" id="symbolToggle">
      Use symbolic notation (♭, △, p)
    </label>
    <label id="displayModeLabel">
      Display mode:
      <select id="noteDisplayMode">
        <option value="sharp">Sharps (C#)</option>
        <option value="flat">Flats (Db)</option>
        <option value="both">Both (C#/Db)</option>
        <option value="interval">Interval symbols from root</option>
      </select>
    </label>
    <button onclick="resetFretboard()">Reset</button>
  </div>
  <div class="fretboard-wrapper">
    <div class="fretboard" id="fretboard"></div>
  </div>
  <div id="intervalDisplay"></div>

  <script>
    const sharpNotes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const flatNotes  = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];
    const tuning = ['E', 'B', 'G', 'D', 'A', 'E'];

    const intervals = [
      { name: 'Unison', abbr: 'P1', symbol: 'R' },
      { name: 'Minor 2nd', abbr: 'm2', symbol: '♭2' },
      { name: 'Major 2nd', abbr: 'M2', symbol: '△2' },
      { name: 'Minor 3rd', abbr: 'm3', symbol: '♭3' },
      { name: 'Major 3rd', abbr: 'M3', symbol: '△3' },
      { name: 'Perfect 4th', abbr: 'P4', symbol: 'p4' },
      { name: 'Tritone', abbr: 'TT', symbol: '♭5' },
      { name: 'Perfect 5th', abbr: 'P5', symbol: 'p5' },
      { name: 'Minor 6th', abbr: 'm6', symbol: '♭6' },
      { name: 'Major 6th', abbr: 'M6', symbol: '△6' },
      { name: 'Minor 7th', abbr: 'm7', symbol: '♭7' },
      { name: 'Major 7th', abbr: 'M7', symbol: '△7' },
    ];

    const fretboard = document.getElementById('fretboard');
    const intervalDisplay = document.getElementById('intervalDisplay');
    const abbrToggle = document.getElementById('abbrToggle');
    const symbolToggle = document.getElementById('symbolToggle');
    const displayMode = document.getElementById('noteDisplayMode');

    let rootNote = null;
    let rootNoteAbs = null;
    let targetNote = null;

    function getNoteAt(start, fret, useFlats = false) {
      const scale = useFlats ? flatNotes : sharpNotes;
      const startIndex = sharpNotes.indexOf(start);
      const idx = (startIndex + fret) % 12;
      return scale[idx];
    }

    function getInterval(root, target) {
      const rootIdx = sharpNotes.indexOf(root);
      const targetIdx = sharpNotes.indexOf(target);
      const semitones = (targetIdx - rootIdx + 12) % 12;
      if (symbolToggle.checked) return intervals[semitones].symbol;
      if (abbrToggle.checked) return intervals[semitones].abbr;
      return intervals[semitones].name;
    }

    function renderFretboard() {
      fretboard.innerHTML = '';
      const mode = displayMode.value;
      const showFlats = mode === 'flat' || mode === 'both';
      const showBoth = mode === 'both';
      const showIntervalSymbols = mode === 'interval';

      // First row: fret numbers
      fretboard.appendChild(document.createElement('div')); // Empty corner
      for (let fret = 0; fret <= 12; fret++) {
        const label = document.createElement('div');
        label.className = 'fret-label';
        label.innerText = fret;
        fretboard.appendChild(label);
      }

      tuning.forEach((openNote, stringIndex) => {
        const stringLabel = document.createElement('div');
        stringLabel.className = 'string-label';
        stringLabel.innerText = openNote;
        fretboard.appendChild(stringLabel);

        for (let fret = 0; fret <= 12; fret++) {
          const sharp = getNoteAt(openNote, fret, false);
          const flat = getNoteAt(openNote, fret, true);

          const noteDiv = document.createElement('div');
          noteDiv.className = 'note';
          noteDiv.dataset.note = sharp;
          noteDiv.dataset.string = stringIndex;
          noteDiv.dataset.fret = fret;

          if (showIntervalSymbols && rootNoteAbs) {
            const interval = getInterval(rootNoteAbs, sharp);
            noteDiv.innerText = interval;
          } else {
            noteDiv.innerText = showBoth && sharp !== flat ? `${sharp}/${flat}` : (showFlats ? flat : sharp);
          }

          noteDiv.addEventListener('click', () => handleNoteClick(noteDiv));
          fretboard.appendChild(noteDiv);
        }
      });
    }

    function handleNoteClick(div) {
      const note = div.dataset.note;
      if (!rootNote) {
        rootNote = note;
        rootNoteAbs = note;
        div.classList.add('selected');
        div.innerText = 'R';
        intervalDisplay.innerText = `Root note set: ${note}`;
      } else if (!targetNote) {
        targetNote = note;
        div.classList.add('target');
        const interval = getInterval(rootNote, targetNote);
        div.innerText = interval;
        intervalDisplay.innerText = `Interval from ${rootNote} to ${targetNote}: ${interval}`;
      } else {
        resetFretboard();
      }
    }

    function resetFretboard() {
      rootNote = null;
      rootNoteAbs = null;
      targetNote = null;
      renderFretboard();
      intervalDisplay.innerText = '';
    }

    displayMode.addEventListener('change', renderFretboard);

    renderFretboard();
  </script>
</body>
</html>
